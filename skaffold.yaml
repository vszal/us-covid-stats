apiVersion: skaffold/v2beta15
kind: Config
metadata:
  name: covid-stats
build:
  local: 
    push: false
  artifacts:
  - image: covid-stats
    context: .
    docker:
      dockerfile: docker/pythonalpine.Dockerfile
    sync:
      infer:
        - 'app.py'
        - 'templates/*.html'
        - 'static/*.*'
deploy:
  kubectl:
    #manifests:
    #- ["k8s/*.yaml"]
portForward:
- resourceType: deployment
  resourceName: covid-stats-deployment
  port: 8080 
  localPort: 8080
profiles:
  - name: packs
    build:
      local: 
        push: false
      artifacts:
      - image: covid-stats
        buildpacks:
          builder: gcr.io/buildpacks/builder
        #sync:
        #  manual:
        #    - src: 'app.py'
        #     dest: /layers/google.python.pip/pip/lib/python3.8/site-packages/flask/
        #    - src: 'templates/*.html'
        #      dest: /layers/google.python.pip/pip/lib/python3.8/site-packages/flask/templates
        #    - src: 'static/*.*'
        #      dest: /layers/google.python.pip/pip/lib/python3.8/site-packages/flask/static 
  - name: distroless
    build:
      local:
        push: false
      artifacts:
      - image: covid-stats
        docker:
          dockerfile: docker/distroless.Dockerfile
  - name: prod
    build:
      googleCloudBuild:
        projectId: victor-misc
      artifacts:
      - image: covid-stats
        docker:
          dockerfile: docker/distroless.Dockerfile
